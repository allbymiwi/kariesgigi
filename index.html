<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>kARies - AR Edukasi Gigi</title>

  <!-- A-Frame + AR.js -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/aframe-extras@6.1.1/dist/aframe-extras.min.js"></script>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: "Poppins", sans-serif;
      background: #f0f4f9;
    }

    a-scene {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* === UI OVERLAY === */
    #ui {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      pointer-events: none;
    }

    /* === STATUS BAR CONTAINER === */
    #bars {
      position: absolute;
      top: 25px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: auto;
      align-items: center;
      pointer-events: none;
    }

    .status-bar {
      display: flex;
      align-items: center;
      background: rgba(60, 60, 60, 0.9);
      border-radius: 20px;
      padding: 6px 12px;
      min-width: 350px;
      height: 24px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    }

    .status-icon {
      width: 25px;
      height: 25px;
      margin-right: 8px;
    }

    .status-label {
      color: #fff;
      font-size: 13px;
      font-weight: 600;
      margin-right: 10px;
      min-width: 75px;
    }

    .bar-fill {
      flex: 1;
      height: 20px;
      border-radius: 10px;
      background: #555;
      overflow: hidden;
      position: relative;
    }

    .bar-inner {
      height: 100%;
      width: 100%;
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    /* warna bar */
    .clean .bar-inner {
      background: linear-gradient(to right, #4fc3f7, #0288d1);
    }

    .health .bar-inner {
      background: linear-gradient(to right, #ef9a9a, #e57373);
    }

    /* animasi health damage */
    .bar-inner.damage {
      animation: blinkRed 0.4s ease;
    }

    @keyframes blinkRed {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(2); }
    }

    /* === BUTTONS === */
    #buttons {
      width: 100%;
      max-width: 400px;
      display: flex;
      gap: 30px;
      justify-content: center;
      margin-bottom: 25px;
      pointer-events: auto;
    }

    .action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      background: none;
      border: none;
      cursor: pointer;
      transition: transform 0.15s ease;
    }

    .action-btn:hover {
      transform: translateY(-3px);
    }

    .action-btn:active {
      transform: scale(0.9);
      transition: transform 0.05s ease;
    }

    .action-btn img {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      margin-bottom: 4px;
      object-fit: contain;
      padding: 10px;
      background: #fff;
      filter: drop-shadow(0 0 6px rgba(0,0,0,0.3));
    }

    .action-btn span {
      font-size: 13px;
      font-weight: 600;
      color: #fff;
      text-shadow: 0 1px 4px rgba(0,0,0,0.4);
    }

    /* === WARNA LATAR BULATAN IKON === */
    .action-btn.brush img { background: #b2e8ff; }
    .action-btn.healthy img { background: #c8f7c2; }
    .action-btn.sweet img { background: #ffd4e1; }

    /* === INFO TEXT === */
    #infoText {
      background: rgba(255, 255, 255, 0.9);
      border-radius: 15px;
      padding: 8px 14px;
      margin-bottom: 15px;
      font-size: 13px;
      font-weight: 500;
      color: #0b4f8a;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      text-align: center;
      max-width: 380px;
      pointer-events: auto;
      transition: opacity 0.3s ease;
    }
  </style>
</head>

<body>
  <!-- AR Scene -->
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-marker type="pattern" url="marker.patt">
      <a-entity id="tooth"
        gltf-model="tooth.glb"
        scale="0.5 0.5 0.5"
        position="0 0 0"
        animation-mixer>
      </a-entity>
    </a-marker>
    <a-entity camera></a-entity>
  </a-scene>

  <!-- UI Overlay -->
  <div id="ui">
    <div id="bars">
      <div class="status-bar clean">
        <img src="icons/water.png" class="status-icon" alt="Kebersihan">
        <span class="status-label">Kebersihan</span>
        <div class="bar-fill"><div id="cleanFill" class="bar-inner"></div></div>
      </div>

      <div class="status-bar health">
        <img src="icons/heart.png" class="status-icon" alt="Kesehatan">
        <span class="status-label">Kesehatan</span>
        <div class="bar-fill"><div id="healthFill" class="bar-inner"></div></div>
      </div>
    </div>

    <div id="infoText">Arahkan kamera ke marker untuk memulai!</div>

    <div id="buttons">
      <button class="action-btn brush" onclick="setAction('brush')">
        <img src="icons/sikat.png" alt="Gosok Gigi">
        <span>Gosok Gigi</span>
      </button>

      <button class="action-btn healthy" onclick="setAction('healthy')">
        <img src="icons/wortel.png" alt="Makanan Sehat">
        <span>Makanan Sehat</span>
      </button>

      <button class="action-btn sweet" onclick="setAction('sweet')">
        <img src="icons/permen.png" alt="Makanan Manis">
        <span>Makanan Manis</span>
      </button>
    </div>
  </div>

  <script>
    let toothModel = null;
    const info = document.getElementById('infoText');
    const cleanFill = document.getElementById('cleanFill');
    const healthFill = document.getElementById('healthFill');

    let cleanValue = 100;
    let healthValue = 100;
    let sweetCount = 0; // hitung berapa kali makan permen

    document.addEventListener('DOMContentLoaded', () => {
      const modelEl = document.querySelector('#tooth');
      modelEl.addEventListener('model-loaded', () => {
        toothModel = modelEl;
        fadeInfo("Model gigi siap! Pilih aksi di bawah ini.");
      });
      updateBars();
    });

    function fadeInfo(text) {
      info.style.opacity = 0;
      setTimeout(() => {
        info.textContent = text;
        info.style.opacity = 1;
      }, 250);
    }

    function updateBars() {
      cleanFill.style.width = cleanValue + "%";
      healthFill.style.width = healthValue + "%";
    }

    function setAction(action) {
      if (!toothModel) return;

      switch (action) {
        case 'brush':
          cleanValue = 100;
          healthValue = 100;
          sweetCount = 0;
          fadeInfo("ü™• Gigi bersih total! Sehat kembali ‚ú®");
          break;

        case 'sweet':
          cleanValue -= 12.5;
          sweetCount++;
          if (sweetCount >= 2) {
            sweetCount = 0;
            healthValue -= 25;
            document.querySelector('.health .bar-inner').classList.add('damage');
            fadeInfo("‚ö†Ô∏è Terlalu sering makan manis! Kesehatan menurun!");
            setTimeout(() => {
              document.querySelector('.health .bar-inner').classList.remove('damage');
            }, 500);
          } else {
            fadeInfo("üç≠ Gula menempel! Kebersihan menurun sedikit...");
          }
          break;

        case 'healthy':
          fadeInfo("ü•¶ Makanan sehat baik untuk gigi, namun harus tetap menggosok gigi ya!");
          break;
      }

      cleanValue = Math.max(0, cleanValue);
      healthValue = Math.max(0, healthValue);
      updateBars();

      if (healthValue <= 0) {
        fadeInfo("üíÄ Gigi rusak total! Yuk sikat gigi untuk memulihkannya!");
      }
    }
  </script>
</body>
</html>
